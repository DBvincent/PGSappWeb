/**Created by ex-dongbo on 2017/4/10*/
var download="http://a.app.qq.com/o/simple.jsp?pkgname=com.dashuf.disp.v2";var registerData={"cv":"10"};var headers={"content-type":"application/json"};var check="false";var obj={};$(function(){find();isFrist(obj);getAjax("POST","../../guest/dictionary/businessCities",headers," ",getBusinessCityData);inputView();clickView()});function inputView(){$("#tel").focus(function(){openButton();if($(this).attr("placeholder")=="手机号不能为空"||$(this).attr("placeholder")=="手机号输入有误"){$(this).removeClass("error");$(this).attr("placeholder","请输入手机号码");$(this).val("")}$(this).attr("type","tel");$(this).css("color","#666666")});$("#pass").focus(function(){openButton();if($(this).attr("placeholder")=="您输入的密码格式有误"||$(this).attr("placeholder")=="密码不能为空"){$(this).removeClass("error");$(this).attr("placeholder","字母+数字组合，大于等于8位");$(this).val("")}$(this).css("color","#666666")});$("#verification").focus(function(){openButton();if($(this).attr("placeholder")=="错误"){$(this).removeClass("error");$(this).attr("placeholder","错误,请重新获取");$(this).val("")}$(this).css("color","#666666")});$("#choose").focus(function(){openButton();console.log(1);if(check=="true"){check="false"}else{check="true"}});$("#tel").blur(function(){verifyTelphone(this)});$("#pass").blur(function(){checkPass(this)});$("#verification").blur(function(){verifyNumber(this)})}function clickView(){$("#news").click(function(){getAjax("POST","../../guest/register/passcode",headers,JSON.stringify({"cellphone":$("#tel").val(),"CV":"10"}),getVerificationCode)});$("#btn").click(function(){console.log("进入提交");if($("#choose").is(':checked')){if(verify()){getData();toAjax("POST","../../guest/register/new",headers,registerData,submitRequest)}}else{$("#layer p").html("请阅读点击用户协议");$("#layer").fadeIn();$("#layer").fadeOut(2000)}});$("#user").click(function(e){e.preventDefault();save();self.location="https://disp-dashboard.banketech.com/static/files/agreement.html"});$("#city").click(function(){$(this).css("color","#666666");openButton()});$("#city").click(function(){$(".footer").hide()})}function getData(){registerData.cellphone=$("#tel").val();registerData.password=$("#pass").val();registerData.businessCityCode=$("#city").attr("data-code");registerData.passcode=$("#verification").val();registerData.registerCode=GetQueryString("requestId")}function popPeer(data){var area=new LArea();area.init({'trigger':'#city','keys':{id:'code',name:'name'},'type':1,'data':data,'idx':1});area.className=['area_company'];}function checkPass(ele){var pass=$(ele).val();if(!(/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,}$/.test(pass))){$(ele).addClass("error");$(ele).val("");closeButton();$(ele).attr("placeholder","您输入的密码格式有误")}else if(pass==""){$(ele).addClass("error");$(ele).val("");$(ele).attr("placeholder","密码不能为空");closeButton()}else{$(ele).val(pass)}}function verifyTelphone(ele){var telphone=$(ele).val();if(telphone==""){$(ele).addClass("error");$(ele).val("");$(ele).attr("placeholder","手机号不能为空");closeButton()}else if(!(/^1[34578]\d{9}$/.test(telphone))){$(ele).addClass("error");$(ele).val("");$(ele).attr("placeholder","手机号输入有误");closeButton()}else{$(ele).val(telphone)}}function verifyNumber(ele){var verify=$(ele).val();if(verify==""){$(ele).addClass("error");$(ele).val("");$(ele).attr("placeholder","验证码错误");closeButton()}else{$(ele).val(verify)}}function verifyCity(ele){var city=$(ele).html();if(city=="请选择"){$(ele).html("业务城市不能为空");$(ele).css("color","#ef6762");closeButton()}else{$(ele).html(city);$(ele).css("color","#666666")}}function removeByValue(arr,val){for(var i=0;i<arr.length;i+=1){if(arr[i].name==val){arr.splice(i,1);break}}}function verify(){if($("#tel").val()==""||$("#pass").val()==""||$("#verification").val()==""||$("#city").html()=="常驻城市不能为空"){verifyTelphone($("#tel"));checkPass($("#pass"));verifyNumber($("#verification"));verifyCity($("#city"));closeButton();return false}else{console.log("填写成功");openButton();return true}}function closeButton(){$("#btn").attr("disabled","disabled");$("#btn").css("background","#d3d3d3")}function openButton(){$("#btn").removeAttr("disabled");$("#btn").css("background","#fec43f")}function errorTip(data,text,timeIn,timeOut){closeButton();$("#layer p").html(text);$("#layer").fadeIn(timeIn);$("#layer").fadeOut(timeOut,function(){$("#verification").val("");openButton()})}function successTip(text){$("#layer p").html(text);$("#layer").fadeIn();$("#layer").fadeOut(1000,function(){localStorage.clear();self.location=download;localStorage.clear()})}function getBusinessCityData(data){if(data.succeed){removeByValue(data.data,"客户挖掘中心");$.map(data.data,function(v){v.name=v.name.split("分公司")[0]});popPeer(data.data)}else{errorTip(data,"服务器开小差，请稍后再试",1000,2000)}}function getVerificationCode(data){if(data.succeed){$("#news").attr("disabled","disabled");$("#layer p").html("验证码已奔向您的手机，请等待");$("#layer").fadeIn();$("#layer").fadeOut(2000,function(){$("#news").removeAttr("disabled")});registerData.requestId=data.data}else{errorTip(data,data.message,1000,2000)}}function submitRequest(data){if(data.succeed){successTip("注册成功，正在跳转下载页面")}else{errorTip(data,data.message,1000,2000)}}function getAjax(type,URL,headers,DATA,responseFun){$.ajax({type:type,url:URL,headers:headers,data:DATA,success:function(data){responseFun(data)},error:function(error){errorTip(error,"服务器开小差，请稍后再试",1000,300000)}})}function toAjax(type,URL,headers,DATA,responseFun){$.ajax({type:type,url:URL,headers:headers,data:JSON.stringify(DATA),success:function(data){responseFun(data)},error:function(error){errorTip(error,"服务器开小差，请稍后再试",1000,300000)}})}function GetQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null){return(r[2])}return null}function save(){localStorage.setItem("isFrist","1");localStorage.setItem("tel",$("#tel").val());localStorage.setItem("pass",$("#pass").val());localStorage.setItem("dataCode",$("#city").attr("data-code"));localStorage.setItem("city",$("#city").html());localStorage.setItem("passcode",$("#verification").val())}function find(){var storage=window.localStorage;for(var i=0,len=storage.length;i<len;i+=1){var key=storage.key(i);var value=storage.getItem(key);obj[key]=value;console.log(key+"="+value)}console.log(obj)}function isFrist(obj){if(obj.isFrist=="1"){if(obj.tel){$("#tel").val(obj.tel)}if(obj.pass){$("#pass").val(obj.pass)}if(obj.dataCode){$("#city").attr("data-code",obj.dataCode)}if(obj.city!="请选择"){$("#city").html(obj.city)}if(obj.passcode){$("#verification").val(obj.passcode)}localStorage.clear()}else{return}}